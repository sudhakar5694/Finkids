angular.module("selectize",[]).value("selectizeConfig",{}).directive("selectize",["selectizeConfig","$timeout",function(selectizeConfig,$timeout){return{restrict:"EA",require:"^ngModel",scope:{ngModel:"=",config:"=?",options:"=?",ngDisabled:"=",ngRequired:"&"},link:function(scope,element,attrs,modelCtrl){if(!Selectize)throw new Error("Selectize JavaScript library should be loaded before using this angular module.");Selectize.define("drag_drop",function(options){if(!$.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if("multi"===this.settings.mode){var original,self=this;self.lock=(original=self.lock,function(){var sortable=self.$control.data("sortable");return sortable&&sortable.disable(),original.apply(self,arguments)}),self.unlock=function(){var original=self.unlock;return function(){var sortable=self.$control.data("sortable");return sortable&&sortable.enable(),original.apply(self,arguments)}}(),self.setup=function(){var original=self.setup;return function(){original.apply(this,arguments);var $control=self.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:self.isLocked,start:function(e,ui){ui.placeholder.css("width",ui.helper.css("width")),$control.css({overflow:"visible"})},stop:function(){$control.css({overflow:"hidden"});var active=self.$activeItems?self.$activeItems.slice():null,values=[];$control.children("[data-value]").each(function(){values.push($(this).attr("data-value"))}),self.setValue(values),self.setActiveItem(active)},helper:function(event,ui){var $clone=$(ui).clone();return $clone.css("position","absolute"),$clone.get(0)}})}}()}}),Selectize.define("remove_button",function(options){options=$.extend({label:"&times;",title:"Remove",className:"remove",append:!0},options);function escape_html(str){return(str+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}("single"!==this.settings.mode?function(thisRef,options){var original,self=thisRef,html='<a href="javascript:void(0)" class="'+options.className+'" tabindex="-1" title="'+escape_html(options.title)+'">'+options.label+"</a>";thisRef.setup=(original=self.setup,function(){if(options.append){var render_item=self.settings.render.item;self.settings.render.item=function(data){return html_container=render_item.apply(thisRef,arguments),html_element=html,pos=html_container.search(/(<\/[^>]+>\s*)$/),html_container.substring(0,pos)+html_element+html_container.substring(pos);var html_container,html_element,pos}}original.apply(thisRef,arguments),thisRef.$control.on("click","."+options.className,function(e){if(e.preventDefault(),!self.isLocked){var $item=$(e.currentTarget).parent();self.setActiveItem($item),self.deleteSelection()&&self.setCaret(self.items.length)}})})}:function(thisRef,options){console.log(thisRef),options.className=options.className||"remove-single";var original,self=thisRef,html='<a href="javascript:void(0)" class="'+options.className+'" tabindex="-1" title="'+escape_html(options.title)+'">'+options.label+"</a>";thisRef.setup=(original=self.setup,function(){if(options.append){var id=$(self.$input.context).attr("id"),render_item=($("#"+id),self.settings.render.item);self.settings.render.item=function(data){return html_container=render_item.apply(thisRef,arguments),html_element=html,pos=html_container.search(/(<\/[^>]+>\s*)$/),html_container.substring(0,pos)+html_element+html_container.substring(pos);var html_container,html_element,pos}}original.apply(thisRef,arguments),thisRef.$control.on("click","."+options.className,function(e){e.preventDefault(),self.isLocked||self.clear()})})})(this,options)}),Selectize.defaults.maxItems=null,Selectize.defaults.hideSelected=!0,attrs.position&&(scope.posBottom=attrs.position),Selectize.defaults.onDropdownOpen=function($dropdown){$dropdown.hide().velocity("slideDown",{begin:function(){void 0!==scope.posBottom&&$dropdown.css({"margin-top":"0"})},duration:200,easing:[.4,0,.2,1]})},Selectize.defaults.onDropdownClose=function($dropdown){$dropdown.show().velocity("slideUp",{complete:function(){"undefined"!=typeof posBottom&&$dropdown.css({"margin-top":""})},duration:200,easing:[.4,0,.2,1]})},Selectize.defaults.onChange=function(){$(element).attr("data-parsley-id")&&$(element).parsley().validate()},Selectize.defaults.onInitialize=function(){$(element)[0].selectize.isRequired&&$timeout(function(){$(element).prop("required",!0)})};var selectize,config=angular.extend({},Selectize.defaults,selectizeConfig,scope.config);function toggle(disabled){disabled?selectize.disable():selectize.enable()}modelCtrl.$isEmpty=function(val){return null==val||!val.length};function generateOptions(data){return data?(data=angular.isArray(data)?data:[data],$.map(data,function(opt){return"string"==typeof opt?(input=opt,(data={})[config.labelField]=input,data[config.valueField]=input,data):opt;var input,data})):[]}function updateSelectize(){var isInvalid;isInvalid=(scope.ngRequired()||attrs.required||config.required)&&modelCtrl.$isEmpty(scope.ngModel),modelCtrl.$setValidity("required",!isInvalid),selectize.$control.toggleClass("ng-valid",modelCtrl.$valid),selectize.$control.toggleClass("ng-invalid",modelCtrl.$invalid),selectize.$control.toggleClass("ng-dirty",modelCtrl.$dirty),selectize.$control.toggleClass("ng-pristine",modelCtrl.$pristine);var value=selectize.items.slice();1===config.maxItems&&(value=value[0]),angular.equals(value,scope.ngModel)||(selectize.addOption(generateOptions(scope.ngModel)),selectize.setValue(scope.ngModel))}var onChange=config.onChange,onOptionAdd=config.onOptionAdd;config.onChange=function(){var args=arguments;scope.$evalAsync(function(){var value=selectize.items.slice();1===config.maxItems&&(value=value[0]),angular.equals(value,scope.ngModel)||(modelCtrl.$setViewValue(value),onChange&&onChange.apply(this,args))})},config.onOptionAdd=function(value,data){-1===scope.options.indexOf(data)&&scope.options.push(data),onOptionAdd&&onOptionAdd.apply(this,arguments)},scope.generatedOptions=generateOptions((scope.options||config.options||scope.ngModel).slice()),scope.options.length=0,scope.generatedOptions.forEach(function(item){scope.options.push(item)});var angularCallback=config.onInitialize;config.onInitialize=function(){(selectize=element[0].selectize).addOption(scope.generatedOptions),selectize.setValue(scope.ngModel),angularCallback&&angularCallback(selectize),scope.$watch("options",function(){scope.generatedOptions=generateOptions((scope.options||config.options||scope.ngModel).slice()),scope.options.length=0,scope.generatedOptions.forEach(function(item){scope.options.push(item)}),selectize.clearOptions(),selectize.addOption(scope.generatedOptions),selectize.setValue(scope.ngModel)},!0),scope.$watchCollection("ngModel",updateSelectize),scope.$watch("ngDisabled",toggle)},element.after('<div class="selectize_fix"></div>'),element.selectize(config),element.on("$destroy",function(){selectize&&(selectize.destroy(),element=null)})}}}]),Selectize.define("tooltip",function(options){var original,self=this;this.setup=(original=self.setup,function(){original.apply(this,arguments);var $wrapper=this.$wrapper,$input=this.$input;$input.attr("title")&&$wrapper.attr("title",$input.attr("title")).attr("data-uk-tooltip",$input.attr("data-uk-tooltip"))})}),Selectize.define("disable_options",function(options){var original,self=this;options=$.extend({disableOptions:[]},options),self.onFocus=(original=self.onFocus,function(){original.apply(this,arguments),$.each(options.disableOptions,function(index,option){self.$dropdown_content.find('[data-value="'+String(option)+'"]').addClass("option-disabled")})}),self.onOptionSelect=function(){var original=self.onOptionSelect;return function(e){var value,$target;if(e.preventDefault&&(e.preventDefault(),e.stopPropagation()),!($target=$(e.currentTarget)).hasClass("option-disabled"))return $target.hasClass("create")?self.createItem():((value=$target.attr("data-value"))&&(self.lastQuery=null,self.setTextboxValue(""),self.addItem(value),!self.settings.hideSelected&&e.type&&/mouse/.test(e.type)&&self.setActiveOption(self.getOption(value))),self.blur()),original.apply(this,arguments)}}()});